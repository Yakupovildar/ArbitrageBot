import os
import random
from dataclasses import dataclass, field
from typing import List, Dict, Optional
from datetime import datetime, time, timezone, timedelta

@dataclass
class Config:
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞"""
    
    # API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    MOEX_API_BASE_URL: str = "https://iss.moex.com/iss"
    REQUEST_TIMEOUT: int = 30
    RATE_LIMIT_DELAY: float = 5.0  # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ MOEX API (—É–≤–µ–ª–∏—á–µ–Ω–∞)
    
    # –ü—Ä–∞–≤–∏–ª–∞ MOEX API –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (—É–ª—å—Ç—Ä–∞–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ)
    MAX_REQUESTS_PER_MINUTE: int = 15  # –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É (–µ—â–µ –±–æ–ª—å—à–µ —Å–Ω–∏–∂–µ–Ω–æ)
    MAX_CONCURRENT_REQUESTS: int = 1   # –¢–æ–ª—å–∫–æ 1 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
    RETRY_ATTEMPTS: int = 1            # –ú–∏–Ω–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫
    RETRY_DELAY: float = 8.0           # –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
    BACKOFF_MULTIPLIER: float = 4.0    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å –∑–∞–¥–µ—Ä–∂–∫–∏
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (—É–ª—å—Ç—Ä–∞–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è)
    MAX_PAIRS_PER_BATCH: int = 5       # 5 –ø–∞—Ä –∑–∞ —Ü–∏–∫–ª –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
    BATCH_DELAY: float = 5.0           # –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
    SMART_ROTATION_ENABLED: bool = True # –£–º–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤
    FULL_SCAN_CYCLES: int = 6          # –ë–æ–ª—å—à–µ —Ü–∏–∫–ª–æ–≤ –¥–ª—è 30 –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∞—Ä (30/5)
    MIN_REQUEST_INTERVAL: float = 5.0  # –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    MONITORING_INTERVAL_MIN: int = 300  # 5 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    MONITORING_INTERVAL_MAX: int = 420  # 7 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    MIN_SPREAD_THRESHOLD: float = 1.0  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ (%)
    SPREAD_LEVEL_2: float = 2.0  # –£—Ä–æ–≤–µ–Ω—å –¥–ª—è –∑–µ–ª–µ–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è (%)
    SPREAD_LEVEL_3: float = 3.0  # –£—Ä–æ–≤–µ–Ω—å –¥–ª—è —è—Ä–∫–æ-–∑–µ–ª–µ–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è (%)
    CLOSE_SPREAD_MIN: float = 0.0  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è (%)
    CLOSE_SPREAD_MAX: float = 0.5  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å–ø—Ä–µ–¥ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è (%)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Å–ø—Ä–µ–¥–æ–≤
    MAX_SPREAD_HISTORY: int = 10  # –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø–∏—Å–µ–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å–ø—Ä–µ–¥–æ–≤
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    ADMIN_USERNAME: str = "@Ildaryakupovv"
    SUPPORT_MESSAGE: str = "–î–ª—è —Å–≤—è–∑–∏ —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–∞–ø–∏—à–∏—Ç–µ @Ildaryakupovv"
    
    # –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ MOEX API
    BACKUP_DATA_SOURCES: List[str] = field(default_factory=lambda: [
        "tradingview",
        "investing_com", 
        "yahoo_finance"
    ])
    
    # –†–∞–±–æ—á–∏–µ —á–∞—Å—ã –±–∏—Ä–∂–∏ (–º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è)
    # –ê–∫—Ü–∏–∏ —Å 8:00, —Ñ—å—é—á–µ—Ä—Å—ã —Å 9:00, –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å 9:00
    TRADING_START_TIME: time = time(9, 0)     # 09:00 –ú–°–ö (—Ñ—å—é—á–µ—Ä—Å—ã)
    TRADING_END_TIME: time = time(18, 45)     # 18:45 –ú–°–ö
    TRADING_DAYS: List[int] = field(default_factory=lambda: [0, 1, 2, 3, 4])  # –ü–Ω-–ü—Ç (0=–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
    
    # –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    MONITORED_INSTRUMENTS: Dict[str, str] = field(default_factory=dict)
    
    def __post_init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞"""
        if not self.MONITORED_INSTRUMENTS:
            self.MONITORED_INSTRUMENTS = {
                # ===== –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ù–´–ï =====
                "ABIO": "IS-9.25",  # –ê–í–¢–û–í–ê–ó
                "AFKS": "AK-9.25",  # –ê–§–ö –°–ò–°–¢–ï–ú–ê  
                "AFLT": "AF-9.25",  # –ê—ç—Ä–æ—Ñ–ª–æ—Ç
                "ALRS": "AL-9.25",  # –ê–õ–†–û–°–ê
                "ASTR": "AS-9.25",  # –ê—Å—Ç—Ä–∞ –ì—Ä—É–ø–ø
                "BANE": "BN-9.25",  # –ë–∞—à–Ω–µ—Ñ—Ç
                "BSPB": "BS-9.25",  # –ë–∞–Ω–∫ –°–ü–±
                "CBOM": "CM-9.25",  # –ú–ö–ë
                "CHMF": "CH-9.25",  # –°–µ–≤–µ—Ä—Å—Ç–∞–ª—å
                "FEES": "FS-9.25",  # –î–∞–ª—å—ç–Ω–µ—Ä–≥–æ
                "FESH": "FE-9.25",  # –î–í–ú–ü
                "FLOT": "FL-9.25",  # –°–æ–≤–∫–æ–º—Ñ–ª–æ—Ç
                "GAZP": "GZ-9.25",  # –ì–∞–∑–ø—Ä–æ–º
                "GLDRUBF": "GL-9.25", # –ó–æ–ª–æ—Ç–æ
                "GMKN": "GK-9.25",  # –ì–ú–ö –ù–æ—Ä–Ω–∏–∫–µ–ª—å
                "HYDR": "HY-9.25",  # –†—É—Å–ì–∏–¥—Ä–æ
                "IRAO": "IR-9.25",  # –ò–Ω—Ç–µ—Ä –†–ê–û
                "KMAZ": "KM-9.25",  # –ö–ê–ú–ê–ó
                "LEAS": "LE-9.25",  # –ï–≤—Ä–æ–ø–ª–∞–Ω
                "LKOH": "LK-9.25",  # –õ—É–∫–æ–π–ª
                "MAGN": "MG-9.25",  # –ú–ú–ö
                "MGNT": "MN-9.25",  # –ú–∞–≥–Ω–∏—Ç
                "MOEX": "ME-9.25",  # –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –±–∏—Ä–∂–∞
                "MTLR": "MC-9.25",  # –ú–µ—á–µ–ª
                "MTSS": "MT-9.25",  # –ú–¢–°
                "MVID": "MV-9.25",  # –ú.–í–∏–¥–µ–æ
                "NLMK": "NM-9.25",  # –ù–õ–ú–ö
                "NVTK": "NK-9.25",  # –ù–û–í–ê–¢–≠–ö
                "PHOR": "PH-9.25",  # –§–æ—Å–ê–≥—Ä–æ
                "PIKK": "PI-9.25",  # –ü–ò–ö
                "PLZL": "PZ-9.25",  # –ü–æ–ª—é—Å
                "POSI": "PS-9.25",  # –ì—Ä—É–ø–ø–∞ –ü–æ–∑–∏—Ç–∏–≤
                "RASP": "RA-9.25",  # –†–∞—Å–ø–∞–¥—Å–∫–∞—è
                "RNFT": "RU-9.25",  # –†—É—Å—Å–Ω–µ—Ñ—Ç
                "ROSN": "RN-9.25",  # –†–æ—Å–Ω–µ—Ñ—Ç—å
                "RTKM": "RT-9.25",  # –†–æ—Å—Ç–µ–ª–µ–∫–æ–º
                "RUAL": "RL-9.25",  # –†–£–°–ê–õ
                "SBER": "SR-9.25",  # –°–±–µ—Ä–±–∞–Ω–∫
                "SBERP": "SP-9.25", # –°–±–µ—Ä–±–∞–Ω–∫ –ü
                "SFIN": "SH-9.25",  # –°–§–ò
                "SGZH": "SZ-9.25",  # –°–µ–≥–µ–∂–∞
                "SIBN": "SO-9.25",  # –ì–∞–∑–ø—Ä–æ–º –Ω–µ—Ñ—Ç—å
                "SMLT": "SS-9.25",  # –°–∞–º–æ–ª–µ—Ç
                "SNGS": "SN-9.25",  # –°—É—Ä–≥—É—Ç–Ω–µ—Ñ—Ç–µ–≥–∞–∑
                "SNGSP": "SG-9.25", # –°—É—Ä–≥—É—Ç–Ω–µ—Ñ—Ç–µ–≥–∞–∑ –ü
                "SOFL": "S0-9.25",  # –°–æ—Ñ—Ç–ª–∞–π–Ω
                "SPBE": "SE-9.25",  # –°–ü–ë –ë–∏—Ä–∂–∞
                "SVCB": "SC-9.25",  # –°–æ–≤–∫–æ–º–±–∞–Ω–∫
                "TATN": "TT-9.25",  # –¢–∞—Ç–Ω–µ—Ñ—Ç—å
                "TATNP": "TP-9.25", # –¢–∞—Ç–Ω–µ—Ñ—Ç—å –ü
                "TRNFP": "TN-9.25", # –¢—Ä–∞–Ω—Å–Ω–µ—Ñ—Ç—å –ü
                "VKCO": "VK-9.25",  # VK
                "VTBR": "VB-9.25",  # –í–¢–ë
                "WUSH": "WU-9.25",  # WHOOSH
                
                # ===== –ü–†–û–í–ï–†–ï–ù–ù–´–ï –ì–û–õ–£–ë–´–ï –§–ò–®–ö–ò (–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–æ 14.08.2025) =====
                "SBER": "SBERF",  # –°–±–µ—Ä–±–∞–Ω–∫ - –¥–Ω–µ–≤–Ω–æ–π —Ñ—å—é—á–µ—Ä—Å ‚úÖ 
                "GAZP": "GAZPF",  # –ì–∞–∑–ø—Ä–æ–º - –¥–Ω–µ–≤–Ω–æ–π —Ñ—å—é—á–µ—Ä—Å ‚úÖ
                "LKOH": "LKZ5",   # –õ—É–∫–æ–π–ª - –¥–µ–∫–∞–±—Ä—å 2025 ‚úÖ 
                "GMKN": "GKZ5",   # –ì–ú–ö –ù–æ—Ä–∏–ª—å—Å–∫–∏–π –Ω–∏–∫–µ–ª—å - –¥–µ–∫–∞–±—Ä—å 2025 ‚úÖ
                "VTBR": "VBZ5",   # –í–¢–ë - –¥–µ–∫–∞–±—Ä—å 2025 ‚úÖ  
                "ROSN": "RNZ5",   # –†–æ—Å–Ω–µ—Ñ—Ç—å - –¥–µ–∫–∞–±—Ä—å 2025 ‚úÖ
                "TATN": "TNZ5",   # –¢–∞—Ç–Ω–µ—Ñ—Ç—å - –¥–µ–∫–∞–±—Ä—å 2025 ‚úÖ
                "ALRS": "ALZ5",   # –ê–õ–†–û–°–ê - –¥–µ–∫–∞–±—Ä—å 2025 ‚úÖ
                
                # ===== –ë–ê–ù–ö–û–í–°–ö–ò–ô –°–ï–ö–¢–û–† =====
                "SBERP": "SPZ5",  # –°–±–µ—Ä–±–∞–Ω–∫ (–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ) - –¥–µ–∫–∞–±—Ä—å 2025
                "CBOM": "CMZ5",   # –ú–æ—Å–∫–æ–≤—Å–∫–∏–π –∫—Ä–µ–¥–∏—Ç–Ω—ã–π –±–∞–Ω–∫ - –¥–µ–∫–∞–±—Ä—å 2025
                "BSPB": "BSZ5",   # –ë–∞–Ω–∫ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ - –¥–µ–∫–∞–±—Ä—å 2025
                "SVCB": "SCZ5",   # –°–æ–≤–∫–æ–º–±–∞–Ω–∫ - –¥–µ–∫–∞–±—Ä—å 2025
                
                # ===== –ù–ï–§–¢–ï–ì–ê–ó =====
                "LKOH": "LKZ5",   # –õ—É–∫–æ–π–ª - –¥–µ–∫–∞–±—Ä—å 2025
                "ROSN": "RNZ5",   # –†–æ—Å–Ω–µ—Ñ—Ç—å - –¥–µ–∫–∞–±—Ä—å 2025
                "TATN": "TNZ5",   # –¢–∞—Ç–Ω–µ—Ñ—Ç—å - –¥–µ–∫–∞–±—Ä—å 2025
                "TATP": "TPZ5",   # –¢–∞—Ç–Ω–µ—Ñ—Ç—å (–ø—Ä–∏–≤.) - –¥–µ–∫–∞–±—Ä—å 2025
                "SNGS": "SNZ5",   # –°—É—Ä–≥—É—Ç–Ω–µ—Ñ—Ç–µ–≥–∞–∑ - –¥–µ–∫–∞–±—Ä—å 2025
                "SNGSP": "SGZ5",  # –°—É—Ä–≥—É—Ç–Ω–µ—Ñ—Ç–µ–≥–∞–∑ (–ø—Ä–∏–≤.) - –¥–µ–∫–∞–±—Ä—å 2025
                "NVTK": "NKZ5",   # –ù–û–í–ê–¢–≠–ö - –¥–µ–∫–∞–±—Ä—å 2025
                "SIBN": "SOZ5",   # –ì–∞–∑–ø—Ä–æ–º –Ω–µ—Ñ—Ç—å - –¥–µ–∫–∞–±—Ä—å 2025
                "BANE": "BNZ5",   # –ë–∞—à–Ω–µ—Ñ—Ç - –¥–µ–∫–∞–±—Ä—å 2025
                "RNFT": "RUZ5",   # –†—É—Å—Å–Ω–µ—Ñ—Ç - –¥–µ–∫–∞–±—Ä—å 2025
                
                # ===== –ú–ï–¢–ê–õ–õ–£–†–ì–ò–Ø =====
                "NLMK": "NMZ5",   # –ù–õ–ú–ö - –¥–µ–∫–∞–±—Ä—å 2025
                "MAGN": "MGZ5",   # –ú–ú–ö - –¥–µ–∫–∞–±—Ä—å 2025
                "CHMF": "CHZ5",   # –°–µ–≤–µ—Ä—Å—Ç–∞–ª—å - –¥–µ–∫–∞–±—Ä—å 2025
                "MTLR": "MCZ5",   # –ú–µ—á–µ–ª - –¥–µ–∫–∞–±—Ä—å 2025
                "PLZL": "PZZ5",   # –ü–æ–ª—é—Å - –¥–µ–∫–∞–±—Ä—å 2025
                "POLY": "POZ5",   # –ü–æ–ª–∏–º–µ—Ç–∞–ª–ª - –¥–µ–∫–∞–±—Ä—å 2025
                "RUAL": "RLZ5",   # –†–£–°–ê–õ - –¥–µ–∫–∞–±—Ä—å 2025
                "PHOR": "PHZ5",   # –§–æ—Å–ê–≥—Ä–æ - –¥–µ–∫–∞–±—Ä—å 2025
                "RASP": "RAZ5",   # –†–∞—Å–ø–∞–¥—Å–∫–∞—è - –¥–µ–∫–∞–±—Ä—å 2025
                
                # ===== –≠–õ–ï–ö–¢–†–û–≠–ù–ï–†–ì–ï–¢–ò–ö–ê =====
                "IRAO": "IRZ5",   # –ò–Ω—Ç–µ—Ä –†–ê–û - –¥–µ–∫–∞–±—Ä—å 2025
                "HYDR": "HYZ5",   # –†—É—Å–ì–∏–¥—Ä–æ - –¥–µ–∫–∞–±—Ä—å 2025
                "RSTI": "REZ5",   # –†–æ—Å—Å–µ—Ç–∏ - –¥–µ–∫–∞–±—Ä—å 2025
                "MSNG": "MOZ5",   # –ú–æ—Å—ç–Ω–µ—Ä–≥–æ - –¥–µ–∫–∞–±—Ä—å 2025
                "TRNFP": "TNZ5",  # –¢—Ä–∞–Ω—Å–Ω–µ—Ñ—Ç—å (–ø—Ä–∏–≤.) - –¥–µ–∫–∞–±—Ä—å 2025
                
                # ===== –¢–ï–õ–ï–ö–û–ú–ú–£–ù–ò–ö–ê–¶–ò–ò =====
                "RTKM": "RTZ5",   # –†–æ—Å—Ç–µ–ª–µ–∫–æ–º - –¥–µ–∫–∞–±—Ä—å 2025
                "MTSS": "MTZ5",   # –ú–¢–° - –¥–µ–∫–∞–±—Ä—å 2025
                "TCSI": "TIZ5",   # –¢–ö–° –•–æ–ª–¥–∏–Ω–≥ - –¥–µ–∫–∞–±—Ä—å 2025
                
                # ===== –¢–ï–•–ù–û–õ–û–ì–ò–ò =====
                "YDEX": "YDZ5",   # –Ø–Ω–¥–µ–∫—Å - –¥–µ–∫–∞–±—Ä—å 2025
                "VKCO": "VKZ5",   # VK - –¥–µ–∫–∞–±—Ä—å 2025
                "OZON": "OZZ5",   # Ozon - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "TCSG": "TCZ5",   # TCS Group - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –†–ò–¢–ï–ô–õ –ò –ü–û–¢–†–ï–ë–ò–¢–ï–õ–¨–°–ö–ò–ï –¢–û–í–ê–†–´ =====
                "MGNT": "MNZ5",   # –ú–∞–≥–Ω–∏—Ç - –¥–µ–∫–∞–±—Ä—å 2025
                "FIVE": "FVZ5",   # X5 Retail Group - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "DIXY": "DIZ5",   # –î–∏–∫—Å–∏ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "LENTA": "LTZ5",  # –õ–µ–Ω—Ç–∞ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "MVID": "MVZ5",   # –ú.–í–∏–¥–µ–æ - –¥–µ–∫–∞–±—Ä—å 2025
                
                # ===== –î–ï–í–ï–õ–û–ü–ú–ï–ù–¢ –ò –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–¨ =====
                "PIKK": "PIZ5",   # –ü–ò–ö - –¥–µ–∫–∞–±—Ä—å 2025
                "SMLT": "SSZ5",   # –°–∞–º–æ–ª–µ—Ç - –¥–µ–∫–∞–±—Ä—å 2025
                "LSRG": "LSZ5",   # –õ–°–† - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "ETALON": "ETZ5", # –≠—Ç–∞–ª–æ–Ω - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –¢–†–ê–ù–°–ü–û–†–¢ =====
                "AFLT": "AFZ5",   # –ê—ç—Ä–æ—Ñ–ª–æ—Ç - –¥–µ–∫–∞–±—Ä—å 2025
                "FESH": "FEZ5",   # –î–í–ú–ü - –¥–µ–∫–∞–±—Ä—å 2025
                "FLOT": "FLZ5",   # –°–æ–≤–∫–æ–º—Ñ–ª–æ—Ç - –¥–µ–∫–∞–±—Ä—å 2025
                "KMAZ": "KMZ5",   # –ö–ê–ú–ê–ó - –¥–µ–∫–∞–±—Ä—å 2025
                
                # ===== –§–ê–†–ú–ê–¶–ï–í–¢–ò–ö–ê –ò –ó–î–†–ê–í–û–û–•–†–ê–ù–ï–ù–ò–ï =====
                "PHST": "PSZ5",   # –§–∞—Ä–º–°—Ç–∞–Ω–¥–∞—Ä—Ç - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "GEMC": "GEZ5",   # –ì–µ–Ω–µ—Ç–∏–∫–æ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –•–ò–ú–ò–Ø –ò –ù–ï–§–¢–ï–•–ò–ú–ò–Ø =====
                "AKRN": "AKZ5",   # –ê–∫—Ä–æ–Ω - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "NKNC": "NKZ5",   # –ù–∏–∂–Ω–µ–∫–∞–º—Å–∫–Ω–µ—Ñ—Ç–µ—Ö–∏–º - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "URKZ": "URZ5",   # –£—Ä–∞–ª–∫–∞–ª–∏–π - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –ú–ê–®–ò–ù–û–°–¢–†–û–ï–ù–ò–ï =====
                "KMAZ": "KMZ5",   # –ö–ê–ú–ê–ó - –¥–µ–∫–∞–±—Ä—å 2025
                "LIFE": "LFZ5",   # –§–∞—Ä–º—Å–∏–Ω—Ç–µ–∑ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== IT –ò –°–û–§–¢ =====
                "ISKJ": "ISZ5",   # –ò—Å–∫—Ä–∞ - –¥–µ–∫–∞–±—Ä—å 2025
                "POSI": "PSZ5",   # –ì—Ä—É–ø–ø–∞ –ü–æ–∑–∏—Ç–∏–≤ - –¥–µ–∫–∞–±—Ä—å 2025
                "ASTR": "ASZ5",   # –ê—Å—Ç—Ä–∞ –ì—Ä—É–ø–ø - –¥–µ–∫–∞–±—Ä—å 2025
                "SOFL": "S0Z5",   # –°–æ—Ñ—Ç–ª–∞–π–Ω - –¥–µ–∫–∞–±—Ä—å 2025
                "WUSH": "WUZ5",   # WHOOSH - –¥–µ–∫–∞–±—Ä—å 2025
                "DIAS": "DIZ5",   # –î–∏–∞—Å–æ—Ñ—Ç - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –ë–ò–†–ñ–ò –ò –§–ò–ù–£–°–õ–£–ì–ò =====
                "MOEX": "MEZ5",   # –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –±–∏—Ä–∂–∞ - –¥–µ–∫–∞–±—Ä—å 2025
                "SPBE": "SEZ5",   # –°–ü–ë –ë–∏—Ä–∂–∞ - –¥–µ–∫–∞–±—Ä—å 2025
                "SFIN": "SHZ5",   # –°–§–ò - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –ü–†–û–ú–´–®–õ–ï–ù–ù–û–°–¢–¨ =====
                "SGZH": "SZZ5",   # –°–µ–≥–µ–∂–∞ –ì—Ä—É–ø–ø - –¥–µ–∫–∞–±—Ä—å 2025
                "LEAS": "LEZ5",   # –ï–≤—Ä–æ–ø–ª–∞–Ω - –¥–µ–∫–∞–±—Ä—å 2025
                "BELUGA": "NBZ5", # –ù–æ–≤–∞–ë–µ–≤ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –ú–ï–ñ–î–£–ù–ê–†–û–î–ù–´–ï ETF –ò –î–ï–†–ò–í–ê–¢–ò–í–´ =====
                "SPY": "SFZ5",    # SPY ETF - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "QQQ": "NAZ5",    # NASDAQ QQQ ETF - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "DAX": "DXZ5",    # DAX ETF - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "HANG": "HSZ5",   # Hang Seng ETF - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "NIKKEI": "N2Z5", # Nikkei ETF - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "EURO50": "SXZ5", # Euro Stoxx 50 ETF - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "RUSSELL": "R2Z5", # Russell 2000 ETF - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "MSCI_EM": "EMZ5", # MSCI Emerging Markets ETF - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –í–ê–õ–Æ–¢–ù–´–ï –ü–ê–†–´ (–§–¨–Æ–ß–ï–†–°–´) =====
                "USDRUB": "SIZ5", # USD/RUB - –¥–µ–∫–∞–±—Ä—å 2025
                "EURRUB": "EuZ5", # EUR/RUB - –¥–µ–∫–∞–±—Ä—å 2025  
                "CNYRUB": "CRZ5", # CNY/RUB - –¥–µ–∫–∞–±—Ä—å 2025
                "TRYRUB": "TYZ5", # TRY/RUB - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "HKDRUB": "HKZ5", # HKD/RUB - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –¢–û–í–ê–†–ù–´–ï –§–¨–Æ–ß–ï–†–°–´ =====
                "GOLD_RUB": "GLZ5",   # –ó–æ–ª–æ—Ç–æ –≤ —Ä—É–±–ª—è—Ö - –¥–µ–∫–∞–±—Ä—å 2025
                "SILVER_RUB": "SLZ5", # –°–µ—Ä–µ–±—Ä–æ –≤ —Ä—É–±–ª—è—Ö - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "BRENT": "BRZ5",      # –ù–µ—Ñ—Ç—å Brent - –¥–µ–∫–∞–±—Ä—å 2025
                "NATGAS": "NGZ5",     # –ü—Ä–∏—Ä–æ–¥–Ω—ã–π –≥–∞–∑ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "WHEAT": "WHZ5",      # –ü—à–µ–Ω–∏—Ü–∞ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "SUGAR": "SUZ5",      # –°–∞—Ö–∞—Ä - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –ò–ù–î–ï–ö–°–ù–´–ï –§–¨–Æ–ß–ï–†–°–´ =====
                "MOEX_IDX": "MXZ5",   # –ò–Ω–¥–µ–∫—Å MOEX - –¥–µ–∫–∞–±—Ä—å 2025
                "RTS_IDX": "RIZ5",    # –ò–Ω–¥–µ–∫—Å RTS - –¥–µ–∫–∞–±—Ä—å 2025
                "MOEX_MINI": "MMZ5",  # –ú–∏–Ω–∏ MOEX - –¥–µ–∫–∞–±—Ä—å 2025
                "RTS_MINI": "RMZ5",   # –ú–∏–Ω–∏ RTS - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                
                # ===== –ù–û–í–´–ï –ò –ü–ï–†–°–ü–ï–ö–¢–ò–í–ù–´–ï –ê–ö–¢–ò–í–´ =====
                "AFKS": "AKZ5",   # –ê–§–ö –°–∏—Å—Ç–µ–º–∞ - –¥–µ–∫–∞–±—Ä—å 2025
                "AQUA": "AQZ5",   # –ò–ù–ê–†–ö–¢–ò–ö–ê - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "VSMO": "VSZ5",   # –í–°–ú–ü–û-–ê–í–ò–°–ú–ê - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "KOGK": "KOZ5",   # –ö–æ–ª—ç–Ω–µ—Ä–≥–æ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "UPRO": "UPZ5",   # –Æ–Ω–∏–ø—Ä–æ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "KOGK": "KOZ5",   # –ö–æ–ª—ç–Ω–µ—Ä–≥–æ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "UPRO": "UPZ5",   # –Æ–Ω–∏–ø—Ä–æ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ –µ—Å—Ç—å)
                "TATN": "TNZ5",   # –¢–∞—Ç–Ω–µ—Ñ—Ç—å - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
                "NLMK": "NLZ5",   # –ù–õ–ú–ö - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
                "ALRS": "ALZ5",   # –ê–ª—Ä–æ—Å–∞ - –¥–µ–∫–∞–±—Ä—å 2025 (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
                
                # –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç 300+ –ø–∞—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
                # –ú–µ—Ç–∞–ª–ª—É—Ä–≥–∏—è, —Ö–∏–º–∏—è, —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, —Ä–∏—Ç–µ–π–ª, —Ç–µ–ª–µ–∫–æ–º, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
                
                # –í–†–ï–ú–ï–ù–ù–û –û–¢–ö–õ–Æ–ß–ï–ù–´ –î–õ–Ø –°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–ò:
                # –ú–µ—Ç–∞–ª–ª—É—Ä–≥–∏—è: 40+ –ø–∞—Ä
                # –•–∏–º–∏—è –∏ –Ω–µ—Ñ—Ç–µ—Ö–∏–º–∏—è: 35+ –ø–∞—Ä  
                # –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞: 50+ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
                # –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: 25+ –ø–∞—Ä
                # –†–∏—Ç–µ–π–ª –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã: 30+ –ø–∞—Ä
                # –¢–µ–ª–µ–∫–æ–º: 15+ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
                # –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: 20+ –ø–∞—Ä
                # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–∫–≤–∏–¥–Ω—ã–µ –∞–∫—Ç–∏–≤—ã: 50+ –ø–∞—Ä
            }
    
    @classmethod
    def get_admin_users(cls) -> List[int]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
        admin_ids_str = os.getenv("ADMIN_USER_IDS", "")
        if not admin_ids_str:
            return []
        
        try:
            return [int(user_id.strip()) for user_id in admin_ids_str.split(",") if user_id.strip()]
        except ValueError:
            return []
    
    @classmethod
    def is_admin(cls, user_id: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º"""
        return user_id in cls.get_admin_users()
    
    def get_lot_multipliers(self) -> Dict[str, int]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä–æ–≤ –ª–æ—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤"""
        return {
            # –ê–∫—Ü–∏–∏ - —Ä–∞–∑–º–µ—Ä –ª–æ—Ç–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ü–∏–π –≤ –æ–¥–Ω–æ–º –ª–æ—Ç–µ)
            "SBER": 100,    # –°–±–µ—Ä–±–∞–Ω–∫ - 100 –∞–∫—Ü–∏–π –≤ –ª–æ—Ç–µ
            "GAZP": 100,    # –ì–∞–∑–ø—Ä–æ–º - 100 –∞–∫—Ü–∏–π –≤ –ª–æ—Ç–µ
            "GMKN": 1,      # –ì–ú–ö –ù–æ—Ä–∏–ª—å—Å–∫–∏–π –Ω–∏–∫–µ–ª—å - 1 –∞–∫—Ü–∏—è –≤ –ª–æ—Ç–µ
            "FEES": 1000,   # –§–°–ö –ï–≠–° - 1000 –∞–∫—Ü–∏–π –≤ –ª–æ—Ç–µ  
            "VTBR": 1000,   # –í–¢–ë - 1000 –∞–∫—Ü–∏–π –≤ –ª–æ—Ç–µ
            "LKOH": 1,      # –õ—É–∫–æ–π–ª - 1 –∞–∫—Ü–∏—è –≤ –ª–æ—Ç–µ
            "ROSN": 1,      # –†–æ—Å–Ω–µ—Ñ—Ç—å - 1 –∞–∫—Ü–∏—è –≤ –ª–æ—Ç–µ
            "TATN": 1,      # –¢–∞—Ç–Ω–µ—Ñ—Ç—å - 1 –∞–∫—Ü–∏—è –≤ –ª–æ—Ç–µ
            "NLMK": 100,    # –ù–õ–ú–ö - 100 –∞–∫—Ü–∏–π –≤ –ª–æ—Ç–µ
            "ALRS": 100,    # –ê–ª—Ä–æ—Å–∞ - 100 –∞–∫—Ü–∏–π –≤ –ª–æ—Ç–µ
        }
    
    def get_futures_lot_value(self, ticker: str) -> float:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ –ª–æ—Ç–∞ —Ñ—å—é—á–µ—Ä—Å–∞ –≤ —Ä—É–±–ª—è—Ö"""
        # –§—å—é—á–µ—Ä—Å—ã –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
        futures_multipliers = {
            "SBERF": 100,    # 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 100 –∞–∫—Ü–∏–π –°–±–µ—Ä–±–∞–Ω–∫–∞
            "GAZPF": 100,    # 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 100 –∞–∫—Ü–∏–π –ì–∞–∑–ø—Ä–æ–º–∞
            "GKZ5": 10,      # 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 10 –∞–∫—Ü–∏–π –ì–ú–ö–ù–∞
            "FSZ5": 1000,    # 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 1000 –∞–∫—Ü–∏–π –§–°–ö –ï–≠–°
            "VBZ5": 1000,    # 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 1000 –∞–∫—Ü–∏–π –í–¢–ë
            "LKZ5": 10,      # 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 10 –∞–∫—Ü–∏–π –õ—É–∫–æ–π–ª–∞
            "RNZ5": 10,      # 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 10 –∞–∫—Ü–∏–π –†–æ—Å–Ω–µ—Ñ—Ç–∏
            "TNZ5": 10,      # 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 10 –∞–∫—Ü–∏–π –¢–∞—Ç–Ω–µ—Ñ—Ç–∏
            "NLZ5": 100,     # 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 100 –∞–∫—Ü–∏–π –ù–õ–ú–ö
            "ALZ5": 100,     # 1 –∫–æ–Ω—Ç—Ä–∞–∫—Ç = 100 –∞–∫—Ü–∏–π –ê–ª—Ä–æ—Å—ã
        }
        return futures_multipliers.get(ticker, 1)
    
    def get_random_monitoring_interval(self) -> int:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –º–µ–∂–¥—É 5-7 –º–∏–Ω—É—Ç–∞–º–∏"""
        return random.randint(self.MONITORING_INTERVAL_MIN, self.MONITORING_INTERVAL_MAX)
    
    def is_market_open(self, dt: Optional[datetime] = None) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞, –æ—Ç–∫—Ä—ã—Ç–∞ –ª–∏ –±–∏—Ä–∂–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è"""
        if dt is None:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è - UTC + 3 —á–∞—Å–∞ —Å–µ–π—á–∞—Å –∑–∏–º–æ–π
            import pytz
            moscow_tz = pytz.timezone('Europe/Moscow')
            dt = datetime.now(moscow_tz)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (0=–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 6=–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
        if dt.weekday() not in self.TRADING_DAYS:
            return False
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è —Ç–æ—Ä–≥–æ–≤
        current_time = dt.time()
        return self.TRADING_START_TIME <= current_time <= self.TRADING_END_TIME
    
    def get_market_status_message(self) -> str:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ —Ä—ã–Ω–∫–∞"""
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è
        import pytz
        moscow_tz = pytz.timezone('Europe/Moscow')
        now = datetime.now(moscow_tz)
        
        if self.is_market_open(now):
            return "üü¢ –ë–∏—Ä–∂–∞ –æ—Ç–∫—Ä—ã—Ç–∞"
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –±–∏—Ä–∂–∞
        if now.weekday() in self.TRADING_DAYS:
            if now.time() < self.TRADING_START_TIME:
                return f"üî¥ –ë–∏—Ä–∂–∞ –∑–∞–∫—Ä—ã—Ç–∞\nüìÖ –û—Ç–∫—Ä–æ–µ—Ç—Å—è —Å–µ–≥–æ–¥–Ω—è –≤ {self.TRADING_START_TIME.strftime('%H:%M')} –ú–°–ö"
            else:
                return f"üî¥ –ë–∏—Ä–∂–∞ –∑–∞–∫—Ä—ã—Ç–∞\nüìÖ –û—Ç–∫—Ä–æ–µ—Ç—Å—è –∑–∞–≤—Ç—Ä–∞ –≤ {self.TRADING_START_TIME.strftime('%H:%M')} –ú–°–ö"
        else:
            # –í—ã—Ö–æ–¥–Ω–æ–π –¥–µ–Ω—å
            days = ['–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–≤—Ç–æ—Ä–Ω–∏–∫', '—Å—Ä–µ–¥—É', '—á–µ—Ç–≤–µ—Ä–≥', '–ø—è—Ç–Ω–∏—Ü—É', '—Å—É–±–±–æ—Ç—É', '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ']
            next_trading_day = min(self.TRADING_DAYS)
            return f"üî¥ –ë–∏—Ä–∂–∞ –∑–∞–∫—Ä—ã—Ç–∞ (–≤—ã—Ö–æ–¥–Ω–æ–π)\nüìÖ –û—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ {days[next_trading_day]} –≤ {self.TRADING_START_TIME.strftime('%H:%M')} –ú–°–ö"
    
    def get_trading_schedule_info(self) -> str:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏ —Ç–æ—Ä–≥–æ–≤"""
        return f"""üìä –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–∏:

üìà –ê–∫—Ü–∏–∏: 08:00 - {self.TRADING_END_TIME.strftime('%H:%M')} –ú–°–ö
üìä –§—å—é—á–µ—Ä—Å—ã: {self.TRADING_START_TIME.strftime('%H:%M')} - {self.TRADING_END_TIME.strftime('%H:%M')} –ú–°–ö
ü§ñ –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: {self.TRADING_START_TIME.strftime('%H:%M')} - {self.TRADING_END_TIME.strftime('%H:%M')} –ú–°–ö
üìÖ –¢–æ—Ä–≥–æ–≤—ã–µ –¥–Ω–∏: –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –ü—è—Ç–Ω–∏—Ü–∞
üö´ –í—ã—Ö–æ–¥–Ω—ã–µ: –°—É–±–±–æ—Ç–∞, –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ

‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏"""
    
    def get_futures_specs(self) -> Dict[str, Dict]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π —Ñ—å—é—á–µ—Ä—Å–æ–≤"""
        return {
            "SiM5": {"underlying": "USD/RUB", "lot_size": 1000, "tick_size": 0.0001},
            "GZM5": {"underlying": "GAZP", "lot_size": 100, "tick_size": 0.001},
            "LKM5": {"underlying": "LKOH", "lot_size": 10, "tick_size": 0.01},
            "NVM5": {"underlying": "NVTK", "lot_size": 10, "tick_size": 0.01},
            "YNM5": {"underlying": "YNDX", "lot_size": 1, "tick_size": 0.01},
            "TCM5": {"underlying": "TCSG", "lot_size": 1, "tick_size": 0.01},
            "RSM5": {"underlying": "ROSN", "lot_size": 10, "tick_size": 0.01},
            "GMM5": {"underlying": "GMKN", "lot_size": 1, "tick_size": 0.01},
            "PLM5": {"underlying": "PLZL", "lot_size": 1, "tick_size": 0.01},
            "MGM5": {"underlying": "MGNT", "lot_size": 1, "tick_size": 0.01},
            "SGM5": {"underlying": "SNGS", "lot_size": 100, "tick_size": 0.001},
            "VTM5": {"underlying": "VTBR", "lot_size": 1000, "tick_size": 0.0001},
            "ALM5": {"underlying": "ALRS", "lot_size": 10, "tick_size": 0.001},
            "TTM5": {"underlying": "TATN", "lot_size": 10, "tick_size": 0.01},
            "MTM5": {"underlying": "MTSS", "lot_size": 10, "tick_size": 0.01},
        }
